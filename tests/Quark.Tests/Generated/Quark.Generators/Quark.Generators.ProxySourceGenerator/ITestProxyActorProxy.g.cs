// <auto-generated/>
#nullable enable
using System;
using System.Threading;
using System.Threading.Tasks;
using ProtoBuf;
using Quark.Client;
using Quark.Networking.Abstractions;

namespace Quark.Tests.Generated
{
    /// <summary>
    /// Type-safe client proxy for Quark.Tests.ITestProxyActor.
    /// </summary>
    internal sealed class ITestProxyActorProxy : Quark.Tests.ITestProxyActor
    {
        private readonly IClusterClient _client;
        private readonly string _actorId;

        public ITestProxyActorProxy(IClusterClient client, string actorId)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
            _actorId = actorId ?? throw new ArgumentNullException(nameof(actorId));
        }

        public string ActorId => _actorId;

        public Task OnActivateAsync(CancellationToken cancellationToken = default)
        {
            // Client proxies don't implement activation lifecycle
            return Task.CompletedTask;
        }

        public Task OnDeactivateAsync(CancellationToken cancellationToken = default)
        {
            // Client proxies don't implement deactivation lifecycle
            return Task.CompletedTask;
        }

        public System.Threading.Tasks.Task IncrementAsync(int amount)
        {
            var request = new IncrementAsyncRequest
            {
                Amount = amount,
            };

            byte[] payload;
            using (var ms = new System.IO.MemoryStream())
            {
                Serializer.Serialize(ms, request);
                payload = ms.ToArray();
            }

            var envelope = new QuarkEnvelope(
                messageId: Guid.NewGuid().ToString(),
                actorId: _actorId,
                actorType: "TestProxyActor",
                methodName: "IncrementAsync",
                payload: payload);

            return SendWithoutResultAsync(envelope);

            async Task SendWithoutResultAsync(QuarkEnvelope env)
            {
                var response = await _client.SendAsync(env, default);

                if (response.IsError)
                {
                    throw new InvalidOperationException($"Actor call failed: {response.ErrorMessage}");
                }
            }
        }

        public System.Threading.Tasks.Task<int> GetCountAsync()
        {
            byte[] payload = Array.Empty<byte>();

            var envelope = new QuarkEnvelope(
                messageId: Guid.NewGuid().ToString(),
                actorId: _actorId,
                actorType: "TestProxyActor",
                methodName: "GetCountAsync",
                payload: payload);

            return SendWithResultAsync(envelope);

            async Task<int> SendWithResultAsync(QuarkEnvelope env)
            {
                var response = await _client.SendAsync(env, default);

                if (response.IsError)
                {
                    throw new InvalidOperationException($"Actor call failed: {response.ErrorMessage}");
                }

                if (response.ResponsePayload == null || response.ResponsePayload.Length == 0)
                {
                    throw new InvalidOperationException("Expected response payload but received none.");
                }

                using var ms = new System.IO.MemoryStream(response.ResponsePayload);
                var result = Serializer.Deserialize<GetCountAsyncResponse>(ms);
                return result.Result;
            }
        }

        public System.Threading.Tasks.Task<string> ProcessMessageAsync(string message, int priority)
        {
            var request = new ProcessMessageAsyncRequest
            {
                Message = message,
                Priority = priority,
            };

            byte[] payload;
            using (var ms = new System.IO.MemoryStream())
            {
                Serializer.Serialize(ms, request);
                payload = ms.ToArray();
            }

            var envelope = new QuarkEnvelope(
                messageId: Guid.NewGuid().ToString(),
                actorId: _actorId,
                actorType: "TestProxyActor",
                methodName: "ProcessMessageAsync",
                payload: payload);

            return SendWithResultAsync(envelope);

            async Task<string> SendWithResultAsync(QuarkEnvelope env)
            {
                var response = await _client.SendAsync(env, default);

                if (response.IsError)
                {
                    throw new InvalidOperationException($"Actor call failed: {response.ErrorMessage}");
                }

                if (response.ResponsePayload == null || response.ResponsePayload.Length == 0)
                {
                    throw new InvalidOperationException("Expected response payload but received none.");
                }

                using var ms = new System.IO.MemoryStream(response.ResponsePayload);
                var result = Serializer.Deserialize<ProcessMessageAsyncResponse>(ms);
                return result.Result;
            }
        }

        public System.Threading.Tasks.Task ResetAsync()
        {
            byte[] payload = Array.Empty<byte>();

            var envelope = new QuarkEnvelope(
                messageId: Guid.NewGuid().ToString(),
                actorId: _actorId,
                actorType: "TestProxyActor",
                methodName: "ResetAsync",
                payload: payload);

            return SendWithoutResultAsync(envelope);

            async Task SendWithoutResultAsync(QuarkEnvelope env)
            {
                var response = await _client.SendAsync(env, default);

                if (response.IsError)
                {
                    throw new InvalidOperationException($"Actor call failed: {response.ErrorMessage}");
                }
            }
        }

    }
}
